# 要件書

## はじめに

JMAアメダスサイトの気象データテーブルに不快指数（Temperature-Humidity Index）を追加する機能です。不快指数は気温と湿度から算出される指標で、人間の体感的な暑さや不快さを数値化したものです。既存の体積絶対湿度や露点温度の計算機能と同様に、テーブルに新しい列として追加されます。

## 要件

### 要件1

**ユーザーストーリー:** 気象データ利用者として、JMAアメダスサイトで不快指数を確認したいので、既存のテーブルに不快指数の列が自動的に追加されることを望む

#### 受入基準

1. WHEN ユーザーがJMAアメダスのエリアテーブルページを開いた時 THEN システムは気温と湿度のデータがある行に対して不快指数を計算し、新しい列として表示する SHALL
2. WHEN ユーザーがJMAアメダスの時系列テーブルページを開いた時 THEN システムは気温と湿度のデータがある行に対して不快指数を計算し、新しい列として表示する SHALL
3. WHEN 気温または湿度のデータが欠損している時 THEN システムは該当セルに「---」を表示する SHALL

### 要件2

**ユーザーストーリー:** 気象データ利用者として、正確な不快指数を確認したいので、標準的な計算式に基づいた値が表示されることを望む

#### 受入基準

1. WHEN システムが不快指数を計算する時 THEN 式 0.81×Td + 0.01×H×(0.99×Td - 14.3) + 46.3 を使用する SHALL（Td: 気温[°C], H: 湿度[%]）
2. WHEN 計算結果を表示する時 THEN 小数点以下1桁まで表示する SHALL
3. WHEN 気温または湿度が負の値の時 THEN システムは通常通り計算を行い結果を表示する SHALL

### 要件3

**ユーザーストーリー:** 気象データ利用者として、不快指数の意味を理解したいので、列ヘッダーに適切な名称が表示されることを望む

#### 受入基準

1. WHEN システムが不快指数列を追加する時 THEN 列ヘッダーに「不快指数」と表示する SHALL

### 要件4

**ユーザーストーリー:** 既存機能の利用者として、不快指数追加後も他の機能が正常に動作することを望む

#### 受入基準

1. WHEN 不快指数機能が追加された時 THEN 既存の体積絶対湿度計算機能は正常に動作し続ける SHALL
2. WHEN 不快指数機能が追加された時 THEN 既存の露点温度計算機能は正常に動作し続ける SHALL
3. WHEN テーブルが更新された時 THEN 全ての追加列（体積絶対湿度、露点温度、不快指数）が適切に再計算される SHALL
