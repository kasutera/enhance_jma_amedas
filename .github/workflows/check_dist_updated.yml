name: Check dist/jma.user.js Updated

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: write
  pull-requests: write

jobs:
  check-dist-updated:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '24'
        cache: 'npm'

    - name: Install dependencies
      run: npm install

    - name: Build project
      run: npm run build

    - name: Create Pull Request for updated dist
      uses: peter-evans/create-pull-request@v7
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: |
          Update dist/jma.user.js with latest build output
          
          The dist/jma.user.js file was outdated and has been updated to match the current source code.
          
          ðŸ¤– Auto-generated by GitHub Actions
        title: Update dist/jma.user.js with latest build output
        body: |
          ## Summary
          The `dist/jma.user.js` file was outdated and has been automatically updated to match the current source code.
          
          ## Changes
          - Updated `dist/jma.user.js` with the latest build output from `npm run build`
          
          ## Test plan
          - [x] Verified that the updated file matches the current build output
          - [ ] Manual review of the changes
          
          ðŸ¤– Auto-generated by GitHub Actions
        branch: update-dist-jma-user-js
        delete-branch: true
